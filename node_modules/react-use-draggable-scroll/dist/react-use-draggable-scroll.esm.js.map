{"version":3,"file":"react-use-draggable-scroll.esm.js","sources":["../src/useIsomorphicLayoutEffect.ts","../src/index.tsx"],"sourcesContent":["import { useLayoutEffect, useEffect } from 'react';\n\nconst useIsomorphicLayoutEffect =\n  typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n\nexport default useIsomorphicLayoutEffect;\n","import { MutableRefObject, useEffect, useRef } from \"react\";\n\nimport useLayoutEffect from \"./useIsomorphicLayoutEffect\";\n\ntype OptionsType = {\n  decayRate?: number;\n  safeDisplacement?: number;\n  applyRubberBandEffect?: boolean;\n  activeMouseButton?: \"Left\" | \"Middle\" | \"Right\";\n  isMounted?: boolean;\n};\n\ntype ReturnType = {\n  events: {\n    onMouseDown: (e: React.MouseEvent<HTMLElement>) => void;\n  };\n};\n\nexport function useDraggable(\n  ref: MutableRefObject<HTMLElement>,\n  {\n    decayRate = 0.95,\n    safeDisplacement = 10,\n    applyRubberBandEffect = false,\n    activeMouseButton = \"Left\",\n    isMounted = true,\n  }: OptionsType = {}\n): ReturnType {\n  const internalState = useRef({\n    isMouseDown: false,\n    isDraggingX: false,\n    isDraggingY: false,\n    initialMouseX: 0,\n    initialMouseY: 0,\n    lastMouseX: 0,\n    lastMouseY: 0,\n    scrollSpeedX: 0,\n    scrollSpeedY: 0,\n    lastScrollX: 0,\n    lastScrollY: 0,\n  });\n\n  let isScrollableAlongX = false;\n  let isScrollableAlongY = false;\n  let maxHorizontalScroll = 0;\n  let maxVerticalScroll = 0;\n  let cursorStyleOfWrapperElement: string;\n  let cursorStyleOfChildElements: string[];\n  let transformStyleOfChildElements: string[];\n  let transitionStyleOfChildElements: string[];\n\n  const timing = (1 / 60) * 1000; // period of most monitors (60fps)\n\n  useLayoutEffect(() => {\n    if (isMounted) {\n      isScrollableAlongX =\n        window.getComputedStyle(ref.current).overflowX === \"scroll\";\n      isScrollableAlongY =\n        window.getComputedStyle(ref.current).overflowY === \"scroll\";\n\n      maxHorizontalScroll = ref.current.scrollWidth - ref.current.clientWidth;\n      maxVerticalScroll = ref.current.scrollHeight - ref.current.clientHeight;\n\n      cursorStyleOfWrapperElement = window.getComputedStyle(ref.current).cursor;\n\n      cursorStyleOfChildElements = [];\n      transformStyleOfChildElements = [];\n      transitionStyleOfChildElements = [];\n\n      (ref.current.childNodes as NodeListOf<HTMLOptionElement>).forEach(\n        (child: HTMLElement) => {\n          cursorStyleOfChildElements.push(\n            window.getComputedStyle(child).cursor\n          );\n\n          transformStyleOfChildElements.push(\n            window.getComputedStyle(child).transform === \"none\"\n              ? \"\"\n              : window.getComputedStyle(child).transform\n          );\n\n          transitionStyleOfChildElements.push(\n            window.getComputedStyle(child).transition === \"none\"\n              ? \"\"\n              : window.getComputedStyle(child).transition\n          );\n        }\n      );\n    }\n  }, [isMounted]);\n\n  const runScroll = () => {\n    const dx = internalState.current.scrollSpeedX * timing;\n    const dy = internalState.current.scrollSpeedY * timing;\n    const offsetX = ref.current.scrollLeft + dx;\n    const offsetY = ref.current.scrollTop + dy;\n\n    ref.current.scrollLeft = offsetX; // eslint-disable-line no-param-reassign\n    ref.current.scrollTop = offsetY; // eslint-disable-line no-param-reassign\n    internalState.current.lastScrollX = offsetX;\n    internalState.current.lastScrollY = offsetY;\n  };\n\n  const rubberBandCallback = (e: MouseEvent) => {\n    const dx = e.clientX - internalState.current.initialMouseX;\n    const dy = e.clientY - internalState.current.initialMouseY;\n\n    const { clientWidth, clientHeight } = ref.current;\n\n    let displacementX = 0;\n    let displacementY = 0;\n\n    if (isScrollableAlongX && isScrollableAlongY) {\n      displacementX =\n        0.3 *\n        clientWidth *\n        Math.sign(dx) *\n        Math.log10(1.0 + (0.5 * Math.abs(dx)) / clientWidth);\n      displacementY =\n        0.3 *\n        clientHeight *\n        Math.sign(dy) *\n        Math.log10(1.0 + (0.5 * Math.abs(dy)) / clientHeight);\n    } else if (isScrollableAlongX) {\n      displacementX =\n        0.3 *\n        clientWidth *\n        Math.sign(dx) *\n        Math.log10(1.0 + (0.5 * Math.abs(dx)) / clientWidth);\n    } else if (isScrollableAlongY) {\n      displacementY =\n        0.3 *\n        clientHeight *\n        Math.sign(dy) *\n        Math.log10(1.0 + (0.5 * Math.abs(dy)) / clientHeight);\n    }\n\n    (ref.current.childNodes as NodeListOf<HTMLOptionElement>).forEach(\n      (child: HTMLElement) => {\n        child.style.transform = `translate3d(${displacementX}px, ${displacementY}px, 0px)`; // eslint-disable-line no-param-reassign\n        child.style.transition = \"transform 0ms\"; // eslint-disable-line no-param-reassign\n      }\n    );\n  };\n\n  const recoverChildStyle = () => {\n    (ref.current.childNodes as NodeListOf<HTMLOptionElement>).forEach(\n      (child: HTMLElement, i) => {\n        child.style.transform = transformStyleOfChildElements[i]; // eslint-disable-line no-param-reassign\n        child.style.transition = transitionStyleOfChildElements[i]; // eslint-disable-line no-param-reassign\n      }\n    );\n  };\n\n  let rubberBandAnimationTimer: NodeJS.Timeout;\n  let keepMovingX: NodeJS.Timer;\n  let keepMovingY: NodeJS.Timer;\n\n  const callbackMomentum = () => {\n    const minimumSpeedToTriggerMomentum = 0.05;\n\n    keepMovingX = setInterval(() => {\n      const lastScrollSpeedX = internalState.current.scrollSpeedX;\n      const newScrollSpeedX = lastScrollSpeedX * decayRate;\n      internalState.current.scrollSpeedX = newScrollSpeedX;\n\n      const isAtLeft = ref.current.scrollLeft <= 0;\n      const isAtRight = ref.current.scrollLeft >= maxHorizontalScroll;\n      const hasReachedHorizontalEdges = isAtLeft || isAtRight;\n\n      runScroll();\n\n      if (\n        Math.abs(newScrollSpeedX) < minimumSpeedToTriggerMomentum ||\n        internalState.current.isMouseDown ||\n        hasReachedHorizontalEdges\n      ) {\n        internalState.current.scrollSpeedX = 0;\n        clearInterval(keepMovingX);\n      }\n    }, timing);\n\n    keepMovingY = setInterval(() => {\n      const lastScrollSpeedY = internalState.current.scrollSpeedY;\n      const newScrollSpeedY = lastScrollSpeedY * decayRate;\n      internalState.current.scrollSpeedY = newScrollSpeedY;\n\n      const isAtTop = ref.current.scrollTop <= 0;\n      const isAtBottom = ref.current.scrollTop >= maxVerticalScroll;\n      const hasReachedVerticalEdges = isAtTop || isAtBottom;\n\n      runScroll();\n\n      if (\n        Math.abs(newScrollSpeedY) < minimumSpeedToTriggerMomentum ||\n        internalState.current.isMouseDown ||\n        hasReachedVerticalEdges\n      ) {\n        internalState.current.scrollSpeedY = 0;\n        clearInterval(keepMovingY);\n      }\n    }, timing);\n\n    internalState.current.isDraggingX = false;\n    internalState.current.isDraggingY = false;\n\n    if (applyRubberBandEffect) {\n      const transitionDurationInMilliseconds = 250;\n\n      (ref.current.childNodes as NodeListOf<HTMLOptionElement>).forEach(\n        (child: HTMLElement) => {\n          child.style.transform = `translate3d(0px, 0px, 0px)`; // eslint-disable-line no-param-reassign\n          child.style.transition = `transform ${transitionDurationInMilliseconds}ms`; // eslint-disable-line no-param-reassign\n        }\n      );\n\n      rubberBandAnimationTimer = setTimeout(\n        recoverChildStyle,\n        transitionDurationInMilliseconds\n      );\n    }\n  };\n\n  const preventClick = (e: Event) => {\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    // e.stopPropagation();\n  };\n\n  const getIsMousePressActive = (buttonsCode: number) => {\n    return (\n      (activeMouseButton === \"Left\" && buttonsCode === 1) ||\n      (activeMouseButton === \"Middle\" && buttonsCode === 4) ||\n      (activeMouseButton === \"Right\" && buttonsCode === 2)\n    );\n  };\n\n  const onMouseDown = (e: React.MouseEvent<HTMLElement>) => {\n    const isMouseActive = getIsMousePressActive(e.buttons);\n    if (!isMouseActive) {\n      return;\n    }\n\n    internalState.current.isMouseDown = true;\n    internalState.current.lastMouseX = e.clientX;\n    internalState.current.lastMouseY = e.clientY;\n    internalState.current.initialMouseX = e.clientX;\n    internalState.current.initialMouseY = e.clientY;\n  };\n\n  const onMouseUp = (e: MouseEvent) => {\n    const isDragging =\n      internalState.current.isDraggingX || internalState.current.isDraggingY;\n\n    const dx = internalState.current.initialMouseX - e.clientX;\n    const dy = internalState.current.initialMouseY - e.clientY;\n\n    const isMotionIntentional =\n      Math.abs(dx) > safeDisplacement || Math.abs(dy) > safeDisplacement;\n\n    const isDraggingConfirmed = isDragging && isMotionIntentional;\n\n    if (isDraggingConfirmed) {\n      ref.current.childNodes.forEach((child) => {\n        child.addEventListener(\"click\", preventClick);\n      });\n    } else {\n      ref.current.childNodes.forEach((child) => {\n        child.removeEventListener(\"click\", preventClick);\n      });\n    }\n\n    internalState.current.isMouseDown = false;\n    internalState.current.lastMouseX = 0;\n    internalState.current.lastMouseY = 0;\n\n    ref.current.style.cursor = cursorStyleOfWrapperElement; // eslint-disable-line no-param-reassign\n    (ref.current.childNodes as NodeListOf<HTMLOptionElement>).forEach(\n      (child: HTMLElement, i) => {\n        child.style.cursor = cursorStyleOfChildElements[i]; // eslint-disable-line no-param-reassign\n      }\n    );\n\n    if (isDraggingConfirmed) {\n      callbackMomentum();\n    }\n  };\n\n  const onMouseMove = (e: MouseEvent) => {\n    if (!internalState.current.isMouseDown) {\n      return;\n    }\n\n    e.preventDefault();\n\n    const dx = internalState.current.lastMouseX - e.clientX;\n    internalState.current.lastMouseX = e.clientX;\n\n    internalState.current.scrollSpeedX = dx / timing;\n    internalState.current.isDraggingX = true;\n\n    const dy = internalState.current.lastMouseY - e.clientY;\n    internalState.current.lastMouseY = e.clientY;\n\n    internalState.current.scrollSpeedY = dy / timing;\n    internalState.current.isDraggingY = true;\n\n    ref.current.style.cursor = \"grabbing\"; // eslint-disable-line no-param-reassign\n    (ref.current.childNodes as NodeListOf<HTMLOptionElement>).forEach(\n      (child: HTMLElement) => {\n        child.style.cursor = \"grabbing\"; // eslint-disable-line no-param-reassign\n      }\n    );\n\n    const isAtLeft = ref.current.scrollLeft <= 0 && isScrollableAlongX;\n    const isAtRight =\n      ref.current.scrollLeft >= maxHorizontalScroll && isScrollableAlongX;\n    const isAtTop = ref.current.scrollTop <= 0 && isScrollableAlongY;\n    const isAtBottom =\n      ref.current.scrollTop >= maxVerticalScroll && isScrollableAlongY;\n    const isAtAnEdge = isAtLeft || isAtRight || isAtTop || isAtBottom;\n\n    if (isAtAnEdge && applyRubberBandEffect) {\n      rubberBandCallback(e);\n    }\n\n    runScroll();\n  };\n\n  const handleResize = () => {\n    maxHorizontalScroll = ref.current.scrollWidth - ref.current.clientWidth;\n    maxVerticalScroll = ref.current.scrollHeight - ref.current.clientHeight;\n  };\n\n  useEffect(() => {\n    if (isMounted) {\n      window.addEventListener(\"mouseup\", onMouseUp);\n      window.addEventListener(\"mousemove\", onMouseMove);\n      window.addEventListener(\"resize\", handleResize);\n    }\n    return () => {\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"resize\", handleResize);\n\n      clearInterval(keepMovingX);\n      clearInterval(keepMovingY);\n      clearTimeout(rubberBandAnimationTimer);\n    };\n  }, [isMounted]);\n\n  return {\n    events: {\n      onMouseDown,\n    },\n  };\n}\n"],"names":["useIsomorphicLayoutEffect","window","useLayoutEffect","useEffect","useDraggable","ref","decayRate","safeDisplacement","applyRubberBandEffect","activeMouseButton","isMounted","internalState","useRef","isMouseDown","isDraggingX","isDraggingY","initialMouseX","initialMouseY","lastMouseX","lastMouseY","scrollSpeedX","scrollSpeedY","lastScrollX","lastScrollY","isScrollableAlongX","isScrollableAlongY","maxHorizontalScroll","maxVerticalScroll","cursorStyleOfWrapperElement","cursorStyleOfChildElements","transformStyleOfChildElements","transitionStyleOfChildElements","timing","getComputedStyle","current","overflowX","overflowY","scrollWidth","clientWidth","scrollHeight","clientHeight","cursor","childNodes","forEach","child","push","transform","transition","runScroll","dx","dy","offsetX","scrollLeft","offsetY","scrollTop","rubberBandCallback","e","clientX","clientY","displacementX","displacementY","Math","sign","log10","abs","style","recoverChildStyle","i","rubberBandAnimationTimer","keepMovingX","keepMovingY","callbackMomentum","minimumSpeedToTriggerMomentum","setInterval","lastScrollSpeedX","newScrollSpeedX","isAtLeft","isAtRight","hasReachedHorizontalEdges","clearInterval","lastScrollSpeedY","newScrollSpeedY","isAtTop","isAtBottom","hasReachedVerticalEdges","transitionDurationInMilliseconds","setTimeout","preventClick","preventDefault","stopImmediatePropagation","getIsMousePressActive","buttonsCode","onMouseDown","isMouseActive","buttons","onMouseUp","isDragging","isMotionIntentional","isDraggingConfirmed","addEventListener","removeEventListener","onMouseMove","isAtAnEdge","handleResize","clearTimeout","events"],"mappings":"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"}